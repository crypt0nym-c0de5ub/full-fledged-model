

% FF2 (0x02 * x)
array[0..255, 0..7] of int: FF2 = array2d(0..255, 0..7,
[
0,0,0,0,0,0,0,0, 0,1,0,0,0,0,0,0, 0,0,1,0,0,0,0,0, 0,1,1,0,0,0,0,0, 0,0,0,1,0,0,0,0, 0,1,0,1,0,0,0,0, 0,0,1,1,0,0,0,0, 0,1,1,1,0,0,0,0, 0,0,0,0,1,0,0,0, 0,1,0,0,1,0,0,0, 0,0,1,0,1,0,0,0, 0,1,1,0,1,0,0,0, 0,0,0,1,1,0,0,0, 0,1,0,1,1,0,0,0, 0,0,1,1,1,0,0,0, 0,1,1,1,1,0,0,0, 0,0,0,0,0,1,0,0, 0,1,0,0,0,1,0,0, 0,0,1,0,0,1,0,0, 0,1,1,0,0,1,0,0, 0,0,0,1,0,1,0,0, 0,1,0,1,0,1,0,0, 0,0,1,1,0,1,0,0, 0,1,1,1,0,1,0,0, 0,0,0,0,1,1,0,0, 0,1,0,0,1,1,0,0, 0,0,1,0,1,1,0,0, 0,1,1,0,1,1,0,0, 0,0,0,1,1,1,0,0, 0,1,0,1,1,1,0,0, 0,0,1,1,1,1,0,0, 0,1,1,1,1,1,0,0, 0,0,0,0,0,0,1,0, 0,1,0,0,0,0,1,0, 0,0,1,0,0,0,1,0, 0,1,1,0,0,0,1,0, 0,0,0,1,0,0,1,0, 0,1,0,1,0,0,1,0, 0,0,1,1,0,0,1,0, 0,1,1,1,0,0,1,0, 0,0,0,0,1,0,1,0, 0,1,0,0,1,0,1,0, 0,0,1,0,1,0,1,0, 0,1,1,0,1,0,1,0, 0,0,0,1,1,0,1,0, 0,1,0,1,1,0,1,0, 0,0,1,1,1,0,1,0, 0,1,1,1,1,0,1,0, 0,0,0,0,0,1,1,0, 0,1,0,0,0,1,1,0, 0,0,1,0,0,1,1,0, 0,1,1,0,0,1,1,0, 0,0,0,1,0,1,1,0, 0,1,0,1,0,1,1,0, 0,0,1,1,0,1,1,0, 0,1,1,1,0,1,1,0, 0,0,0,0,1,1,1,0, 0,1,0,0,1,1,1,0, 0,0,1,0,1,1,1,0, 0,1,1,0,1,1,1,0, 0,0,0,1,1,1,1,0, 0,1,0,1,1,1,1,0, 0,0,1,1,1,1,1,0, 0,1,1,1,1,1,1,0, 0,0,0,0,0,0,0,1, 0,1,0,0,0,0,0,1, 0,0,1,0,0,0,0,1, 0,1,1,0,0,0,0,1, 0,0,0,1,0,0,0,1, 0,1,0,1,0,0,0,1, 0,0,1,1,0,0,0,1, 0,1,1,1,0,0,0,1, 0,0,0,0,1,0,0,1, 0,1,0,0,1,0,0,1, 0,0,1,0,1,0,0,1, 0,1,1,0,1,0,0,1, 0,0,0,1,1,0,0,1, 0,1,0,1,1,0,0,1, 0,0,1,1,1,0,0,1, 0,1,1,1,1,0,0,1, 0,0,0,0,0,1,0,1, 0,1,0,0,0,1,0,1, 0,0,1,0,0,1,0,1, 0,1,1,0,0,1,0,1, 0,0,0,1,0,1,0,1, 0,1,0,1,0,1,0,1, 0,0,1,1,0,1,0,1, 0,1,1,1,0,1,0,1, 0,0,0,0,1,1,0,1, 0,1,0,0,1,1,0,1, 0,0,1,0,1,1,0,1, 0,1,1,0,1,1,0,1, 0,0,0,1,1,1,0,1, 0,1,0,1,1,1,0,1, 0,0,1,1,1,1,0,1, 0,1,1,1,1,1,0,1, 0,0,0,0,0,0,1,1, 0,1,0,0,0,0,1,1, 0,0,1,0,0,0,1,1, 0,1,1,0,0,0,1,1, 0,0,0,1,0,0,1,1, 0,1,0,1,0,0,1,1, 0,0,1,1,0,0,1,1, 0,1,1,1,0,0,1,1, 0,0,0,0,1,0,1,1, 0,1,0,0,1,0,1,1, 0,0,1,0,1,0,1,1, 0,1,1,0,1,0,1,1, 0,0,0,1,1,0,1,1, 0,1,0,1,1,0,1,1, 0,0,1,1,1,0,1,1, 0,1,1,1,1,0,1,1, 0,0,0,0,0,1,1,1, 0,1,0,0,0,1,1,1, 0,0,1,0,0,1,1,1, 0,1,1,0,0,1,1,1, 0,0,0,1,0,1,1,1, 0,1,0,1,0,1,1,1, 0,0,1,1,0,1,1,1, 0,1,1,1,0,1,1,1, 0,0,0,0,1,1,1,1, 0,1,0,0,1,1,1,1, 0,0,1,0,1,1,1,1, 0,1,1,0,1,1,1,1, 0,0,0,1,1,1,1,1, 0,1,0,1,1,1,1,1, 0,0,1,1,1,1,1,1, 0,1,1,1,1,1,1,1, 1,1,0,1,1,0,0,0, 1,0,0,1,1,0,0,0, 1,1,1,1,1,0,0,0, 1,0,1,1,1,0,0,0, 1,1,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,1,1,0,1,0,0,0, 1,0,1,0,1,0,0,0, 1,1,0,1,0,0,0,0, 1,0,0,1,0,0,0,0, 1,1,1,1,0,0,0,0, 1,0,1,1,0,0,0,0, 1,1,0,0,0,0,0,0, 1,0,0,0,0,0,0,0, 1,1,1,0,0,0,0,0, 1,0,1,0,0,0,0,0, 1,1,0,1,1,1,0,0, 1,0,0,1,1,1,0,0, 1,1,1,1,1,1,0,0, 1,0,1,1,1,1,0,0, 1,1,0,0,1,1,0,0, 1,0,0,0,1,1,0,0, 1,1,1,0,1,1,0,0, 1,0,1,0,1,1,0,0, 1,1,0,1,0,1,0,0, 1,0,0,1,0,1,0,0, 1,1,1,1,0,1,0,0, 1,0,1,1,0,1,0,0, 1,1,0,0,0,1,0,0, 1,0,0,0,0,1,0,0, 1,1,1,0,0,1,0,0, 1,0,1,0,0,1,0,0, 1,1,0,1,1,0,1,0, 1,0,0,1,1,0,1,0, 1,1,1,1,1,0,1,0, 1,0,1,1,1,0,1,0, 1,1,0,0,1,0,1,0, 1,0,0,0,1,0,1,0, 1,1,1,0,1,0,1,0, 1,0,1,0,1,0,1,0, 1,1,0,1,0,0,1,0, 1,0,0,1,0,0,1,0, 1,1,1,1,0,0,1,0, 1,0,1,1,0,0,1,0, 1,1,0,0,0,0,1,0, 1,0,0,0,0,0,1,0, 1,1,1,0,0,0,1,0, 1,0,1,0,0,0,1,0, 1,1,0,1,1,1,1,0, 1,0,0,1,1,1,1,0, 1,1,1,1,1,1,1,0, 1,0,1,1,1,1,1,0, 1,1,0,0,1,1,1,0, 1,0,0,0,1,1,1,0, 1,1,1,0,1,1,1,0, 1,0,1,0,1,1,1,0, 1,1,0,1,0,1,1,0, 1,0,0,1,0,1,1,0, 1,1,1,1,0,1,1,0, 1,0,1,1,0,1,1,0, 1,1,0,0,0,1,1,0, 1,0,0,0,0,1,1,0, 1,1,1,0,0,1,1,0, 1,0,1,0,0,1,1,0, 1,1,0,1,1,0,0,1, 1,0,0,1,1,0,0,1, 1,1,1,1,1,0,0,1, 1,0,1,1,1,0,0,1, 1,1,0,0,1,0,0,1, 1,0,0,0,1,0,0,1, 1,1,1,0,1,0,0,1, 1,0,1,0,1,0,0,1, 1,1,0,1,0,0,0,1, 1,0,0,1,0,0,0,1, 1,1,1,1,0,0,0,1, 1,0,1,1,0,0,0,1, 1,1,0,0,0,0,0,1, 1,0,0,0,0,0,0,1, 1,1,1,0,0,0,0,1, 1,0,1,0,0,0,0,1, 1,1,0,1,1,1,0,1, 1,0,0,1,1,1,0,1, 1,1,1,1,1,1,0,1, 1,0,1,1,1,1,0,1, 1,1,0,0,1,1,0,1, 1,0,0,0,1,1,0,1, 1,1,1,0,1,1,0,1, 1,0,1,0,1,1,0,1, 1,1,0,1,0,1,0,1, 1,0,0,1,0,1,0,1, 1,1,1,1,0,1,0,1, 1,0,1,1,0,1,0,1, 1,1,0,0,0,1,0,1, 1,0,0,0,0,1,0,1, 1,1,1,0,0,1,0,1, 1,0,1,0,0,1,0,1, 1,1,0,1,1,0,1,1, 1,0,0,1,1,0,1,1, 1,1,1,1,1,0,1,1, 1,0,1,1,1,0,1,1, 1,1,0,0,1,0,1,1, 1,0,0,0,1,0,1,1, 1,1,1,0,1,0,1,1, 1,0,1,0,1,0,1,1, 1,1,0,1,0,0,1,1, 1,0,0,1,0,0,1,1, 1,1,1,1,0,0,1,1, 1,0,1,1,0,0,1,1, 1,1,0,0,0,0,1,1, 1,0,0,0,0,0,1,1, 1,1,1,0,0,0,1,1, 1,0,1,0,0,0,1,1, 1,1,0,1,1,1,1,1, 1,0,0,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,0,1,1,1,1,1,1, 1,1,0,0,1,1,1,1, 1,0,0,0,1,1,1,1, 1,1,1,0,1,1,1,1, 1,0,1,0,1,1,1,1, 1,1,0,1,0,1,1,1, 1,0,0,1,0,1,1,1, 1,1,1,1,0,1,1,1, 1,0,1,1,0,1,1,1, 1,1,0,0,0,1,1,1, 1,0,0,0,0,1,1,1, 1,1,1,0,0,1,1,1, 1,0,1,0,0,1,1,1
]);


% FF3 (0x03 * x)
array[0..255, 0..7] of int: FF3 = array2d(0..255, 0..7,
[
0,0,0,0,0,0,0,0, 1,1,0,0,0,0,0,0, 0,1,1,0,0,0,0,0, 1,0,1,0,0,0,0,0, 0,0,1,1,0,0,0,0, 1,1,1,1,0,0,0,0, 0,1,0,1,0,0,0,0, 1,0,0,1,0,0,0,0, 0,0,0,1,1,0,0,0, 1,1,0,1,1,0,0,0, 0,1,1,1,1,0,0,0, 1,0,1,1,1,0,0,0, 0,0,1,0,1,0,0,0, 1,1,1,0,1,0,0,0, 0,1,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 0,0,0,0,1,1,0,0, 1,1,0,0,1,1,0,0, 0,1,1,0,1,1,0,0, 1,0,1,0,1,1,0,0, 0,0,1,1,1,1,0,0, 1,1,1,1,1,1,0,0, 0,1,0,1,1,1,0,0, 1,0,0,1,1,1,0,0, 0,0,0,1,0,1,0,0, 1,1,0,1,0,1,0,0, 0,1,1,1,0,1,0,0, 1,0,1,1,0,1,0,0, 0,0,1,0,0,1,0,0, 1,1,1,0,0,1,0,0, 0,1,0,0,0,1,0,0, 1,0,0,0,0,1,0,0, 0,0,0,0,0,1,1,0, 1,1,0,0,0,1,1,0, 0,1,1,0,0,1,1,0, 1,0,1,0,0,1,1,0, 0,0,1,1,0,1,1,0, 1,1,1,1,0,1,1,0, 0,1,0,1,0,1,1,0, 1,0,0,1,0,1,1,0, 0,0,0,1,1,1,1,0, 1,1,0,1,1,1,1,0, 0,1,1,1,1,1,1,0, 1,0,1,1,1,1,1,0, 0,0,1,0,1,1,1,0, 1,1,1,0,1,1,1,0, 0,1,0,0,1,1,1,0, 1,0,0,0,1,1,1,0, 0,0,0,0,1,0,1,0, 1,1,0,0,1,0,1,0, 0,1,1,0,1,0,1,0, 1,0,1,0,1,0,1,0, 0,0,1,1,1,0,1,0, 1,1,1,1,1,0,1,0, 0,1,0,1,1,0,1,0, 1,0,0,1,1,0,1,0, 0,0,0,1,0,0,1,0, 1,1,0,1,0,0,1,0, 0,1,1,1,0,0,1,0, 1,0,1,1,0,0,1,0, 0,0,1,0,0,0,1,0, 1,1,1,0,0,0,1,0, 0,1,0,0,0,0,1,0, 1,0,0,0,0,0,1,0, 0,0,0,0,0,0,1,1, 1,1,0,0,0,0,1,1, 0,1,1,0,0,0,1,1, 1,0,1,0,0,0,1,1, 0,0,1,1,0,0,1,1, 1,1,1,1,0,0,1,1, 0,1,0,1,0,0,1,1, 1,0,0,1,0,0,1,1, 0,0,0,1,1,0,1,1, 1,1,0,1,1,0,1,1, 0,1,1,1,1,0,1,1, 1,0,1,1,1,0,1,1, 0,0,1,0,1,0,1,1, 1,1,1,0,1,0,1,1, 0,1,0,0,1,0,1,1, 1,0,0,0,1,0,1,1, 0,0,0,0,1,1,1,1, 1,1,0,0,1,1,1,1, 0,1,1,0,1,1,1,1, 1,0,1,0,1,1,1,1, 0,0,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,1,0,1,1,1,1,1, 1,0,0,1,1,1,1,1, 0,0,0,1,0,1,1,1, 1,1,0,1,0,1,1,1, 0,1,1,1,0,1,1,1, 1,0,1,1,0,1,1,1, 0,0,1,0,0,1,1,1, 1,1,1,0,0,1,1,1, 0,1,0,0,0,1,1,1, 1,0,0,0,0,1,1,1, 0,0,0,0,0,1,0,1, 1,1,0,0,0,1,0,1, 0,1,1,0,0,1,0,1, 1,0,1,0,0,1,0,1, 0,0,1,1,0,1,0,1, 1,1,1,1,0,1,0,1, 0,1,0,1,0,1,0,1, 1,0,0,1,0,1,0,1, 0,0,0,1,1,1,0,1, 1,1,0,1,1,1,0,1, 0,1,1,1,1,1,0,1, 1,0,1,1,1,1,0,1, 0,0,1,0,1,1,0,1, 1,1,1,0,1,1,0,1, 0,1,0,0,1,1,0,1, 1,0,0,0,1,1,0,1, 0,0,0,0,1,0,0,1, 1,1,0,0,1,0,0,1, 0,1,1,0,1,0,0,1, 1,0,1,0,1,0,0,1, 0,0,1,1,1,0,0,1, 1,1,1,1,1,0,0,1, 0,1,0,1,1,0,0,1, 1,0,0,1,1,0,0,1, 0,0,0,1,0,0,0,1, 1,1,0,1,0,0,0,1, 0,1,1,1,0,0,0,1, 1,0,1,1,0,0,0,1, 0,0,1,0,0,0,0,1, 1,1,1,0,0,0,0,1, 0,1,0,0,0,0,0,1, 1,0,0,0,0,0,0,1, 1,1,0,1,1,0,0,1, 0,0,0,1,1,0,0,1, 1,0,1,1,1,0,0,1, 0,1,1,1,1,0,0,1, 1,1,1,0,1,0,0,1, 0,0,1,0,1,0,0,1, 1,0,0,0,1,0,0,1, 0,1,0,0,1,0,0,1, 1,1,0,0,0,0,0,1, 0,0,0,0,0,0,0,1, 1,0,1,0,0,0,0,1, 0,1,1,0,0,0,0,1, 1,1,1,1,0,0,0,1, 0,0,1,1,0,0,0,1, 1,0,0,1,0,0,0,1, 0,1,0,1,0,0,0,1, 1,1,0,1,0,1,0,1, 0,0,0,1,0,1,0,1, 1,0,1,1,0,1,0,1, 0,1,1,1,0,1,0,1, 1,1,1,0,0,1,0,1, 0,0,1,0,0,1,0,1, 1,0,0,0,0,1,0,1, 0,1,0,0,0,1,0,1, 1,1,0,0,1,1,0,1, 0,0,0,0,1,1,0,1, 1,0,1,0,1,1,0,1, 0,1,1,0,1,1,0,1, 1,1,1,1,1,1,0,1, 0,0,1,1,1,1,0,1, 1,0,0,1,1,1,0,1, 0,1,0,1,1,1,0,1, 1,1,0,1,1,1,1,1, 0,0,0,1,1,1,1,1, 1,0,1,1,1,1,1,1, 0,1,1,1,1,1,1,1, 1,1,1,0,1,1,1,1, 0,0,1,0,1,1,1,1, 1,0,0,0,1,1,1,1, 0,1,0,0,1,1,1,1, 1,1,0,0,0,1,1,1, 0,0,0,0,0,1,1,1, 1,0,1,0,0,1,1,1, 0,1,1,0,0,1,1,1, 1,1,1,1,0,1,1,1, 0,0,1,1,0,1,1,1, 1,0,0,1,0,1,1,1, 0,1,0,1,0,1,1,1, 1,1,0,1,0,0,1,1, 0,0,0,1,0,0,1,1, 1,0,1,1,0,0,1,1, 0,1,1,1,0,0,1,1, 1,1,1,0,0,0,1,1, 0,0,1,0,0,0,1,1, 1,0,0,0,0,0,1,1, 0,1,0,0,0,0,1,1, 1,1,0,0,1,0,1,1, 0,0,0,0,1,0,1,1, 1,0,1,0,1,0,1,1, 0,1,1,0,1,0,1,1, 1,1,1,1,1,0,1,1, 0,0,1,1,1,0,1,1, 1,0,0,1,1,0,1,1, 0,1,0,1,1,0,1,1, 1,1,0,1,1,0,1,0, 0,0,0,1,1,0,1,0, 1,0,1,1,1,0,1,0, 0,1,1,1,1,0,1,0, 1,1,1,0,1,0,1,0, 0,0,1,0,1,0,1,0, 1,0,0,0,1,0,1,0, 0,1,0,0,1,0,1,0, 1,1,0,0,0,0,1,0, 0,0,0,0,0,0,1,0, 1,0,1,0,0,0,1,0, 0,1,1,0,0,0,1,0, 1,1,1,1,0,0,1,0, 0,0,1,1,0,0,1,0, 1,0,0,1,0,0,1,0, 0,1,0,1,0,0,1,0, 1,1,0,1,0,1,1,0, 0,0,0,1,0,1,1,0, 1,0,1,1,0,1,1,0, 0,1,1,1,0,1,1,0, 1,1,1,0,0,1,1,0, 0,0,1,0,0,1,1,0, 1,0,0,0,0,1,1,0, 0,1,0,0,0,1,1,0, 1,1,0,0,1,1,1,0, 0,0,0,0,1,1,1,0, 1,0,1,0,1,1,1,0, 0,1,1,0,1,1,1,0, 1,1,1,1,1,1,1,0, 0,0,1,1,1,1,1,0, 1,0,0,1,1,1,1,0, 0,1,0,1,1,1,1,0, 1,1,0,1,1,1,0,0, 0,0,0,1,1,1,0,0, 1,0,1,1,1,1,0,0, 0,1,1,1,1,1,0,0, 1,1,1,0,1,1,0,0, 0,0,1,0,1,1,0,0, 1,0,0,0,1,1,0,0, 0,1,0,0,1,1,0,0, 1,1,0,0,0,1,0,0, 0,0,0,0,0,1,0,0, 1,0,1,0,0,1,0,0, 0,1,1,0,0,1,0,0, 1,1,1,1,0,1,0,0, 0,0,1,1,0,1,0,0, 1,0,0,1,0,1,0,0, 0,1,0,1,0,1,0,0, 1,1,0,1,0,0,0,0, 0,0,0,1,0,0,0,0, 1,0,1,1,0,0,0,0, 0,1,1,1,0,0,0,0, 1,1,1,0,0,0,0,0, 0,0,1,0,0,0,0,0, 1,0,0,0,0,0,0,0, 0,1,0,0,0,0,0,0, 1,1,0,0,1,0,0,0, 0,0,0,0,1,0,0,0, 1,0,1,0,1,0,0,0, 0,1,1,0,1,0,0,0, 1,1,1,1,1,0,0,0, 0,0,1,1,1,0,0,0, 1,0,0,1,1,0,0,0, 0,1,0,1,1,0,0,0 
]);


%   Mix    |tdz_c|        stk_c
% 2,3,1,1, |  a  |  2*a + 3*b + c + d
% 1,2,3,1, |  b  |  a + 2*b + 3*c + d
% 1,1,2,3, |  c  |  a + b + 2*c + 3*d
% 3,1,1,2  |  d  |  3*a + b + c + 2*d
predicate _MC(array[0..3] of var 0..255: bMC_int,
              array[0..3, 0..7] of var 0..1: bMC,
              array[0..3, 0..7] of var 0..1: fMC) =
              forall(i in 0..7)(
                % 2*a + 3*b + c + d
                fMC[0,i] = (FF2[bMC_int[0],i] + FF3[bMC_int[1],i] + bMC[2,i] + bMC[3,i]) mod 2
                /\
                % a + 2*b + 3*c + d
                fMC[1,i] = (bMC[0,i] + FF2[bMC_int[1],i] + FF3[bMC_int[2],i] + bMC[3,i]) mod 2
                /\
                % a + b + 2*c + 3*d
                fMC[2,i] = (bMC[0,i] + bMC[1,i] + FF2[bMC_int[2],i] + FF3[bMC_int[3],i]) mod 2
                /\
                % 3*a + b + c + 2*d
                fMC[3,i] = (FF3[bMC_int[0],i] + bMC[1,i] + bMC[2,i] + FF2[bMC_int[3],i]) mod 2
              )
;